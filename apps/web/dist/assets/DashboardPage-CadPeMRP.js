import{u as L,a as D,r as c,s as b,L as F,j as e,b as z,M as P,U as I,A as H,c as M}from"./index-B3GnaDpY.js";import{A as O,T as U,C as _}from"./analyticsService-GzYYP_ag.js";import{m as l}from"./proxy-CpLBfSVu.js";import{D as V}from"./dollar-sign-BsdDAEV5.js";import{S as $}from"./share-2-wgyq_vRh.js";function N(t,m=2e3){const[d,o]=c.useState(0);return c.useEffect(()=>{let h,x;const r=p=>{h||(h=p);const u=Math.min((p-h)/m,1),j=u===1?1:1-Math.pow(2,-10*u);o(t*j),u<1&&(x=requestAnimationFrame(r))};return x=requestAnimationFrame(r),()=>cancelAnimationFrame(x)},[t,m]),d}function Q(){const{t}=L(),m=D(),[d,o]=c.useState([]),[h,x]=c.useState(!0),[r,p]=c.useState({totalRevenue:0,linkRevenue:0,bioRevenue:0,totalClicks:0,linkClicks:0,bioClicks:0}),[u,j]=c.useState([]),k=N(r.totalRevenue,1500),y=N(r.totalClicks,1500),w=N(0,2e3),[C,f]=c.useState(!1);c.useEffect(()=>{E();const s=b.channel("dashboard-updates").on("postgres_changes",{event:"*",schema:"public",table:"links"},a=>{R(a)}).subscribe();return()=>{b.removeChannel(s)}},[]);const R=s=>{var a;s.eventType==="INSERT"?o(i=>[s.new,...i]):s.eventType==="UPDATE"?(o(i=>i.map(n=>n.id===s.new.id?s.new:n)),s.new.earnings>(((a=s.old)==null?void 0:a.earnings)||0)&&S()):s.eventType==="DELETE"&&o(i=>i.filter(n=>n.id!==s.old.id))},S=()=>{f(!0),setTimeout(()=>f(!1),2e3)};c.useEffect(()=>{if(d.length>0){const s=d.reduce((i,n)=>i+(n.earnings||0),0),a=d.reduce((i,n)=>i+(n.views||0),0);p(i=>({...i,linkRevenue:s,totalRevenue:s+i.bioRevenue,linkClicks:a,totalClicks:a+i.bioClicks}))}},[d]);const E=async()=>{try{const{data:{user:s}}=await b.auth.getUser();if(!s)return;const[a,i]=await Promise.all([O.getDashboardData(),F.getAll()]);a!=null&&a.timeline&&j(a.timeline),i&&(o(i),p(n=>({...n,bioRevenue:(a==null?void 0:a.bioRevenue)||0,bioClicks:(a==null?void 0:a.bioClicks)||0})))}catch(s){console.error(s)}finally{x(!1)}},T=async()=>{const{data:{user:s}}=await b.auth.getUser();if(s){const a=`${window.location.origin}/register?ref=${s.id}`;navigator.clipboard.writeText(a),alert(t("dashboard.stats.referrals.copy_alert"))}},g=d.slice(0,5),A={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},v={hidden:{opacity:0,y:30,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:100,damping:20}}};return h?e.jsx("div",{className:"lp-dashboard-shell",children:e.jsxs("div",{className:"flex h-screen items-center justify-center flex-col gap-4",children:[e.jsx(z,{className:"animate-spin text-indigo-500",size:48}),e.jsx(l.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 text-sm font-medium tracking-wider",children:"LOADING DASHBOARD..."})]})}):e.jsx("div",{className:"lp-dashboard-shell",children:e.jsxs("div",{className:"lp-dashboard-inner",children:[e.jsxs(l.header,{className:"lp-dashboard-header-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:[e.jsxs("div",{className:"lp-chip-center",children:[e.jsx("span",{className:"lp-chip-dot"}),t("dashboard.chip")]}),e.jsx("p",{className:"lp-dashboard-subtitle-center",children:t("dashboard.subtitle")})]}),e.jsxs(l.div,{className:"lp-dashboard-grid",variants:A,initial:"hidden",animate:"visible",children:[e.jsxs(l.div,{className:`lp-dashboard-card lp-card-green ${C?"pulse-green":""}`,variants:v,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(34, 197, 94, 0.25)"},children:[e.jsxs("div",{className:"lp-stat-header",children:[e.jsx("div",{className:"lp-stat-icon",children:e.jsx(V,{size:24})}),e.jsxs("div",{className:"lp-trend-badge",children:[e.jsx(U,{size:12})," LIVE"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:t("dashboard.stats.revenue.label")}),e.jsxs("div",{className:"lp-stat-value",children:["€",k.toFixed(4)]}),e.jsx("div",{className:"h-1 w-full bg-slate-800/50 rounded-full mt-2 mb-4 overflow-hidden",children:e.jsx(l.div,{className:"h-full bg-green-500",initial:{width:0},animate:{width:"100%"},transition:{duration:2,ease:"circOut"}})}),e.jsxs("div",{className:"lp-substats",children:[e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:t("dashboard.stats.revenue.links")}),e.jsxs("span",{className:"lp-substat-value",children:["€",r.linkRevenue.toFixed(4)]})]}),e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:t("dashboard.stats.revenue.bio")}),e.jsxs("span",{className:"lp-substat-value",children:["€",r.bioRevenue.toFixed(4)]})]})]})]})]}),e.jsxs(l.div,{className:"lp-dashboard-card lp-card-blue",variants:v,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(59, 130, 246, 0.25)"},children:[e.jsx("div",{className:"lp-stat-header",children:e.jsx("div",{className:"lp-stat-icon",children:e.jsx(P,{size:24})})}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:t("dashboard.stats.clicks.label")}),e.jsx("div",{className:"lp-stat-value",children:y.toFixed(0)}),e.jsxs("div",{className:"lp-substats",children:[e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:"LINKS"}),e.jsx("span",{className:"lp-substat-value",children:r.linkClicks})]}),e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:"BIO PAGE"}),e.jsx("span",{className:"lp-substat-value",children:r.bioClicks})]})]})]})]}),e.jsxs(l.div,{className:"lp-dashboard-card lp-card-orange",variants:v,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(249, 115, 22, 0.25)"},children:[e.jsx("div",{className:"lp-stat-header",children:e.jsx("div",{className:"lp-stat-icon",children:e.jsx(_,{size:24})})}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:"RPM MEDIO"}),e.jsx("div",{className:"lp-stat-value",children:"€1.22"}),e.jsx("p",{className:"text-xs text-slate-400 mt-1 opacity-80",children:"Por 1000 visitas"})]})]}),e.jsxs(l.div,{className:"lp-dashboard-card lp-card-purple lp-referral-compact",variants:v,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(168, 85, 247, 0.25)"},children:[e.jsxs("div",{className:"lp-referral-header",children:[e.jsxs("div",{className:"lp-referral-left",children:[e.jsx("div",{className:"lp-stat-icon",children:e.jsx(I,{size:24})}),e.jsxs("div",{className:"lp-referral-amount",children:["€",w.toFixed(2)]})]}),e.jsx(l.button,{whileTap:{scale:.9},onClick:T,className:"lp-share-btn",children:e.jsx($,{size:18})})]}),e.jsx("div",{className:"lp-referral-label",children:"Programa de referidos"})]})]}),e.jsxs(l.div,{className:"lp-dashboard-card lp-recent-card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white tracking-tight",children:t("dashboard.recent.title")}),e.jsx("p",{className:"text-sm text-slate-400",children:t("dashboard.recent.subtitle")})]}),e.jsxs(l.button,{whileHover:{x:4,color:"#818cf8"},onClick:()=>m("/app/links"),className:"text-sm font-semibold text-indigo-400 flex items-center gap-1 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},children:[t("dashboard.recent.view_all")," ",e.jsx(H,{size:14})]})]}),e.jsxs("div",{className:"lp-recent-list",children:[g.map((s,a)=>e.jsxs(l.div,{className:"lp-recent-item",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.7+a*.05},whileHover:{backgroundColor:"rgba(255,255,255,0.06)",scale:1.005},children:[e.jsx("div",{className:"lp-link-icon-circle",children:e.jsx(M,{size:16})}),e.jsxs("div",{className:"lp-link-info",children:[e.jsxs("span",{className:"lp-link-alias",children:["/",s.slug]}),e.jsx("span",{className:"lp-link-url",children:s.original_url})]}),e.jsxs("div",{className:"text-right min-w-[80px]",children:[e.jsxs("div",{className:"lp-link-money",children:["€",(s.earnings||0).toFixed(4)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.views||0," clicks"]})]})]},s.id)),g.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-500 text-sm italic",children:t("dashboard.recent.empty_desc")||"No links yet."})]})]})]})})}export{Q as DashboardPage};
