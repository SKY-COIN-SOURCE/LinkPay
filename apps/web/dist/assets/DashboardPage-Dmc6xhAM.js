import{u as L,a as z,r as c,s as v,L as F,j as s,b as D,M as O,U as H,A as I,c as P}from"./index-BcV6dUao.js";import{A as U,R as _,a as M,b as G,C as V}from"./AreaChart-yUae2TX4.js";import{m as l}from"./proxy-Bnx3bzbN.js";import{D as $}from"./dollar-sign-B1NZ6NbY.js";import{T as q}from"./trending-up-DrjNRZJL.js";import{A as B}from"./activity-B-vRqEWS.js";import{C as K}from"./copy-CGg-A0EU.js";function N(i,u=2e3){const[d,o]=c.useState(0);return c.useEffect(()=>{let x,p;const r=m=>{x||(x=m);const h=Math.min((m-x)/u,1),j=h===1?1:1-Math.pow(2,-10*h);o(i*j),h<1&&(p=requestAnimationFrame(r))};return p=requestAnimationFrame(r),()=>cancelAnimationFrame(p)},[i,u]),d}function es(){const{t:i}=L(),u=z(),[d,o]=c.useState([]),[x,p]=c.useState(!0),[r,m]=c.useState({totalRevenue:0,linkRevenue:0,bioRevenue:0,totalClicks:0,linkClicks:0,bioClicks:0}),[h,j]=c.useState([]),y=N(r.totalRevenue,1500),k=N(r.totalClicks,1500),w=N(0,2e3),[C,f]=c.useState(!1);c.useEffect(()=>{S();const e=v.channel("dashboard-updates").on("postgres_changes",{event:"*",schema:"public",table:"links"},a=>{R(a)}).subscribe();return()=>{v.removeChannel(e)}},[]);const R=e=>{var a;e.eventType==="INSERT"?o(t=>[e.new,...t]):e.eventType==="UPDATE"?(o(t=>t.map(n=>n.id===e.new.id?e.new:n)),e.new.earnings>(((a=e.old)==null?void 0:a.earnings)||0)&&A()):e.eventType==="DELETE"&&o(t=>t.filter(n=>n.id!==e.old.id))},A=()=>{f(!0),setTimeout(()=>f(!1),2e3)};c.useEffect(()=>{if(d.length>0){const e=d.reduce((t,n)=>t+(n.earnings||0),0),a=d.reduce((t,n)=>t+(n.views||0),0);m(t=>({...t,linkRevenue:e,totalRevenue:e+t.bioRevenue,linkClicks:a,totalClicks:a+t.bioClicks}))}},[d]);const S=async()=>{try{const{data:{user:e}}=await v.auth.getUser();if(!e)return;const[a,t]=await Promise.all([U.getDashboardData(),F.getAll()]);a!=null&&a.timeline&&j(a.timeline),t&&(o(t),m(n=>({...n,bioRevenue:(a==null?void 0:a.bioRevenue)||0,bioClicks:(a==null?void 0:a.bioClicks)||0})))}catch(e){console.error(e)}finally{p(!1)}},T=async()=>{const{data:{user:e}}=await v.auth.getUser();if(e){const a=`${window.location.origin}/register?ref=${e.id}`;navigator.clipboard.writeText(a),alert(i("dashboard.stats.referrals.copy_alert"))}},g=d.slice(0,5),E={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},b={hidden:{opacity:0,y:30,scale:.95},visible:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:100,damping:20}}};return x?s.jsx("div",{className:"lp-dashboard-shell",children:s.jsxs("div",{className:"flex h-screen items-center justify-center flex-col gap-4",children:[s.jsx(D,{className:"animate-spin text-indigo-500",size:48}),s.jsx(l.span,{initial:{opacity:0},animate:{opacity:1},className:"text-slate-400 text-sm font-medium tracking-wider",children:"LOADING DASHBOARD..."})]})}):s.jsx("div",{className:"lp-dashboard-shell",children:s.jsxs("div",{className:"lp-dashboard-inner",children:[s.jsxs(l.header,{className:"lp-dashboard-header-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6,ease:"easeOut"},children:[s.jsxs("div",{className:"lp-chip-center",children:[s.jsx("span",{className:"lp-chip-dot"}),i("dashboard.chip")]}),s.jsx("p",{className:"lp-dashboard-subtitle-center",children:i("dashboard.subtitle")})]}),s.jsxs(l.div,{className:"lp-dashboard-grid",variants:E,initial:"hidden",animate:"visible",children:[s.jsxs(l.div,{className:`lp-dashboard-card lp-card-green ${C?"pulse-green":""}`,variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(34, 197, 94, 0.25)"},children:[s.jsxs("div",{className:"lp-stat-header",children:[s.jsx("div",{className:"lp-stat-icon",children:s.jsx($,{size:24})}),s.jsxs("div",{className:"lp-trend-badge",children:[s.jsx(q,{size:12})," LIVE"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"lp-stat-label",children:i("dashboard.stats.revenue.label")}),s.jsxs("div",{className:"lp-stat-value",children:["€",y.toFixed(4)]}),s.jsx("div",{className:"h-1 w-full bg-slate-800/50 rounded-full mt-2 mb-4 overflow-hidden",children:s.jsx(l.div,{className:"h-full bg-green-500",initial:{width:0},animate:{width:"100%"},transition:{duration:2,ease:"circOut"}})}),s.jsxs("div",{className:"lp-substats",children:[s.jsxs("div",{className:"lp-substat-box",children:[s.jsx("span",{className:"lp-substat-label",children:i("dashboard.stats.revenue.links")}),s.jsxs("span",{className:"lp-substat-value",children:["€",r.linkRevenue.toFixed(4)]})]}),s.jsxs("div",{className:"lp-substat-box",children:[s.jsx("span",{className:"lp-substat-label",children:i("dashboard.stats.revenue.bio")}),s.jsxs("span",{className:"lp-substat-value",children:["€",r.bioRevenue.toFixed(4)]})]})]})]})]}),s.jsxs(l.div,{className:"lp-dashboard-card lp-card-blue",variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(59, 130, 246, 0.25)"},children:[s.jsxs("div",{className:"lp-stat-header",children:[s.jsx("div",{className:"lp-stat-icon",children:s.jsx(O,{size:24})}),s.jsxs("div",{className:"lp-trend-badge",style:{color:"#60a5fa",background:"rgba(59, 130, 246, 0.1)"},children:[s.jsx(B,{size:12})," +5%"]})]}),s.jsxs("div",{children:[s.jsx("div",{className:"lp-stat-label",children:i("dashboard.stats.clicks.label")}),s.jsx("div",{className:"lp-stat-value",children:k.toFixed(0)}),s.jsx("div",{className:"h-[30px] w-full mt-2 opacity-60",children:h.length>0?s.jsx(_,{width:"100%",height:"100%",children:s.jsxs(M,{data:h,children:[s.jsx("defs",{children:s.jsxs("linearGradient",{id:"colorClicks",x1:"0",y1:"0",x2:"0",y2:"1",children:[s.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),s.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),s.jsx(G,{type:"monotone",dataKey:"clicks",stroke:"#3b82f6",strokeWidth:2,fillOpacity:1,fill:"url(#colorClicks)"})]})}):s.jsx("div",{className:"h-full w-full bg-slate-800/30 rounded animate-pulse"})}),s.jsxs("div",{className:"lp-substats mt-2",children:[s.jsxs("div",{className:"lp-substat-box",children:[s.jsx("span",{className:"lp-substat-label",children:"LINKS"}),s.jsx("span",{className:"lp-substat-value",children:r.linkClicks})]}),s.jsxs("div",{className:"lp-substat-box",children:[s.jsx("span",{className:"lp-substat-label",children:"BIO PAGE"}),s.jsx("span",{className:"lp-substat-value",children:r.bioClicks})]})]})]})]}),s.jsxs(l.div,{className:"lp-dashboard-card lp-card-purple",variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(168, 85, 247, 0.25)"},children:[s.jsxs("div",{className:"lp-stat-header",children:[s.jsx("div",{className:"lp-stat-icon",children:s.jsx(H,{size:24})}),s.jsx(l.div,{whileTap:{scale:.9},children:s.jsx(K,{size:18,className:"text-slate-400 cursor-pointer hover:text-white transition-colors",onClick:T})})]}),s.jsxs("div",{children:[s.jsx("div",{className:"lp-stat-label",children:i("dashboard.stats.referrals.label")}),s.jsxs("div",{className:"lp-stat-value",children:["€",w.toFixed(2)]}),s.jsx("p",{className:"text-xs text-slate-400 mt-2 leading-relaxed opacity-80",children:i("dashboard.stats.referrals.text")})]})]}),s.jsxs(l.div,{className:"lp-dashboard-card lp-card-orange",variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(249, 115, 22, 0.25)"},children:[s.jsx("div",{className:"lp-stat-header",children:s.jsx("div",{className:"lp-stat-icon",children:s.jsx(V,{size:24})})}),s.jsxs("div",{children:[s.jsx("div",{className:"lp-stat-label",children:i("dashboard.stats.rpm.label")}),s.jsx("div",{className:"lp-stat-value",children:"€1.22"}),s.jsx("p",{className:"text-xs text-slate-400 mt-2 opacity-80",children:i("dashboard.stats.rpm.help")||"Average revenue per 1k visits"})]})]})]}),s.jsxs(l.div,{className:"lp-dashboard-card lp-recent-card",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.6,duration:.5},children:[s.jsxs("div",{className:"flex justify-between items-center mb-6",children:[s.jsxs("div",{children:[s.jsx("h3",{className:"text-lg font-bold text-white tracking-tight",children:i("dashboard.recent.title")}),s.jsx("p",{className:"text-sm text-slate-400",children:i("dashboard.recent.subtitle")})]}),s.jsxs(l.button,{whileHover:{x:4,color:"#818cf8"},onClick:()=>u("/app/links"),className:"text-sm font-semibold text-indigo-400 flex items-center gap-1 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},children:[i("dashboard.recent.view_all")," ",s.jsx(I,{size:14})]})]}),s.jsxs("div",{className:"lp-recent-list",children:[g.map((e,a)=>s.jsxs(l.div,{className:"lp-recent-item",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.7+a*.05},whileHover:{backgroundColor:"rgba(255,255,255,0.06)",scale:1.005},children:[s.jsx("div",{className:"lp-link-icon-circle",children:s.jsx(P,{size:16})}),s.jsxs("div",{className:"lp-link-info",children:[s.jsxs("span",{className:"lp-link-alias",children:["/",e.slug]}),s.jsx("span",{className:"lp-link-url",children:e.original_url})]}),s.jsxs("div",{className:"text-right min-w-[80px]",children:[s.jsxs("div",{className:"lp-link-money",children:["€",(e.earnings||0).toFixed(4)]}),s.jsxs("div",{className:"text-xs text-slate-500",children:[e.views||0," clicks"]})]})]},e.id)),g.length===0&&s.jsx("div",{className:"text-center py-8 text-slate-500 text-sm italic",children:i("dashboard.recent.empty_desc")||"No links yet."})]})]})]})})}export{es as DashboardPage};
