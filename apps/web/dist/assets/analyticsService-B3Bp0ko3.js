import{d as u,s}from"./index-DoD1EnLO.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const y=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],S=u("chart-column",y);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],E=u("trending-up",m),M={getDashboardData:async()=>{const{data:{user:n}}=await s.auth.getUser();if(!n)return null;const e=new Date;e.setDate(e.getDate()-30);const{data:o,error:t}=await s.from("clicks").select("created_at, country, device").gte("created_at",e.toISOString());t&&console.warn("[AnalyticsService] error cargando clicks:",t);const{data:c,error:l}=await s.from("bio_profiles").select("earnings, views, monetization_mode").eq("user_id",n.id);l&&console.warn("[AnalyticsService] error cargando bio_profiles:",l);const{data:v,error:d}=await s.from("click_events").select("created_at, country, device").not("bio_profile_id","is",null).gte("created_at",e.toISOString());d&&console.warn("[AnalyticsService] error cargando bio_clicks:",d);const a=[...o||[],...v||[]],k=g(a),p=_(a),b=D(a),f=(c==null?void 0:c.reduce((r,i)=>r+(i.earnings||0),0))||0,h=(c==null?void 0:c.reduce((r,i)=>r+(i.views||0),0))||0;return{timeline:k,devices:p,countries:b,totalClicks:a.length,bioRevenue:f,bioClicks:h}}};function g(n){const e={};for(let o=29;o>=0;o--){const t=new Date;t.setDate(t.getDate()-o);const c=t.toLocaleDateString("es-ES",{day:"numeric",month:"short"});e[c]=0}return n.forEach(o=>{const t=new Date(o.created_at).toLocaleDateString("es-ES",{day:"numeric",month:"short"});e[t]!==void 0&&e[t]++}),Object.keys(e).map(o=>({date:o,clicks:e[o]}))}function _(n){const e={Mobile:0,Desktop:0,Tablet:0};return n.forEach(t=>{const c=t.device||"Desktop";c==="Mobile"?e.Mobile++:c==="Tablet"?e.Tablet++:e.Desktop++}),[{device:"MÃ³vil",value:e.Mobile},{device:"Escritorio",value:e.Desktop},{device:"Tablet",value:e.Tablet}].filter(t=>t.value>0)}function D(n){const e={};return n.forEach(o=>{const t=(o.country||"Unknown").toUpperCase();e[t]=(e[t]||0)+1}),Object.entries(e).map(([o,t])=>({country:o,value:t})).sort((o,t)=>t.value-o.value).slice(0,5)}export{M as A,S as C,E as T};
