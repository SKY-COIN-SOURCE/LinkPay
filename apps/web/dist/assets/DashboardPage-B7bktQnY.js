import{c as I,u as A,a as L,r as n,s as j,L as P,j as e,M as F,A as D,b as M}from"./index-Dxh3r0nY.js";import{A as z}from"./analyticsService-BRhIKcNN.js";import{P as V}from"./PremiumLoader-BOk8w8vh.js";import{m as r}from"./proxy-k4Mbx_EL.js";import{D as _}from"./dollar-sign-CEDKOsjp.js";import{T as H}from"./trending-up-CgruGccz.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],U=I("chart-column",O);function N(l,x=2e3){const[c,o]=n.useState(0);return n.useEffect(()=>{let m,h;const d=p=>{m||(m=p);const u=Math.min((p-m)/x,1),v=u===1?1:1-Math.pow(2,-10*u);o(l*v),u<1&&(h=requestAnimationFrame(d))};return h=requestAnimationFrame(d),()=>cancelAnimationFrame(h)},[l,x]),c}function J(){const{t:l}=A(),x=L(),[c,o]=n.useState([]),[m,h]=n.useState(!0),[d,p]=n.useState({totalRevenue:0,linkRevenue:0,bioRevenue:0,totalClicks:0,linkClicks:0,bioClicks:0}),[u,v]=n.useState([]),k=N(d.totalRevenue,1500),y=N(d.totalClicks,1500),R=N(0,2e3),[w,g]=n.useState(!1);n.useEffect(()=>{S();const s=j.channel("dashboard-updates").on("postgres_changes",{event:"*",schema:"public",table:"links"},a=>{C(a)}).subscribe();return()=>{j.removeChannel(s)}},[]);const C=s=>{var a;s.eventType==="INSERT"?o(i=>[s.new,...i]):s.eventType==="UPDATE"?(o(i=>i.map(t=>t.id===s.new.id?s.new:t)),s.new.earnings>(((a=s.old)==null?void 0:a.earnings)||0)&&E()):s.eventType==="DELETE"&&o(i=>i.filter(t=>t.id!==s.old.id))},E=()=>{g(!0),setTimeout(()=>g(!1),2e3)};n.useEffect(()=>{if(c.length>0){const s=c.reduce((i,t)=>i+(t.earnings||0),0),a=c.reduce((i,t)=>i+(t.views||0),0);p(i=>({...i,linkRevenue:s,totalRevenue:s+i.bioRevenue,linkClicks:a,totalClicks:a+i.bioClicks}))}},[c]);const S=async()=>{try{const{data:{user:s}}=await j.auth.getUser();if(!s)return;const[a,i]=await Promise.all([z.getDashboardData(),P.getAll()]);a!=null&&a.timeline&&v(a.timeline),i&&(o(i),p(t=>({...t,bioRevenue:(a==null?void 0:a.bioRevenue)||0,bioClicks:(a==null?void 0:a.bioClicks)||0})))}catch(s){console.error(s)}finally{h(!1)}},f=c.slice(0,5),T={hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.05,delayChildren:.06}}},b={hidden:{opacity:0,y:20,scale:.97},visible:{opacity:1,y:0,scale:1,transition:{type:"spring",stiffness:180,damping:22}}};return m?e.jsx(V,{size:"medium",text:"LINKPAY",subtext:"Preparando tu dashboard..."}):e.jsx("div",{className:"lp-dashboard-shell",children:e.jsxs("div",{className:"lp-dashboard-inner",children:[e.jsxs(r.div,{className:"lp-dashboard-grid",variants:T,initial:"hidden",animate:"visible",children:[e.jsxs(r.div,{className:`lp-dashboard-card lp-card-green ${w?"pulse-green":""}`,variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(34, 197, 94, 0.25)"},children:[e.jsxs("div",{className:"lp-stat-header",children:[e.jsx("div",{className:"lp-stat-icon",children:e.jsx(_,{size:24})}),e.jsxs("div",{className:"lp-trend-badge",children:[e.jsx(H,{size:12})," LIVE"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:l("dashboard.stats.revenue.label")}),e.jsxs("div",{className:"lp-stat-value",children:["€",k.toFixed(4)]}),e.jsx("div",{className:"h-1 w-full bg-slate-800/50 rounded-full mt-2 mb-4 overflow-hidden",children:e.jsx(r.div,{className:"h-full bg-green-500",initial:{width:0},animate:{width:"100%"},transition:{duration:2,ease:"circOut"}})}),e.jsxs("div",{className:"lp-substats",style:{gridTemplateColumns:"1fr 1fr 1fr"},children:[e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:l("dashboard.stats.revenue.links")}),e.jsxs("span",{className:"lp-substat-value",children:["€",d.linkRevenue.toFixed(4)]})]}),e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:l("dashboard.stats.revenue.bio")}),e.jsxs("span",{className:"lp-substat-value",children:["€",d.bioRevenue.toFixed(4)]})]}),e.jsxs("div",{className:"lp-substat-box",children:[e.jsx("span",{className:"lp-substat-label",children:"REFERIDOS"}),e.jsxs("span",{className:"lp-substat-value",children:["€",R.toFixed(2)]})]})]})]})]}),e.jsxs(r.div,{className:"lp-dashboard-card lp-card-purple",variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(168, 85, 247, 0.25)"},children:[e.jsx("div",{className:"lp-stat-header",children:e.jsx("div",{className:"lp-stat-icon",children:e.jsx(F,{size:24})})}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:l("dashboard.stats.clicks.label")}),e.jsx("div",{className:"lp-stat-value",children:y.toFixed(0)}),e.jsx("div",{className:"lp-substat-label",style:{marginTop:"8px"},children:"LINKS + BIO PAGE"})]})]}),e.jsxs(r.div,{className:"lp-dashboard-card lp-card-orange",variants:b,whileHover:{y:-5,boxShadow:"0 25px 50px -12px rgba(249, 115, 22, 0.25)"},children:[e.jsx("div",{className:"lp-stat-header",children:e.jsx("div",{className:"lp-stat-icon",children:e.jsx(U,{size:24})})}),e.jsxs("div",{children:[e.jsx("div",{className:"lp-stat-label",children:"RPM MEDIO"}),e.jsx("div",{className:"lp-stat-value",children:"€1.22"}),e.jsx("div",{className:"lp-substat-label",style:{marginTop:"8px"},children:"POR 1000 VISITAS"})]})]})]}),e.jsxs(r.div,{className:"lp-dashboard-card lp-recent-card lp-card-blue",initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{delay:.35,duration:.4},children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("div",{className:"lp-stat-label",children:"ACTIVIDAD RECIENTE"}),e.jsxs(r.button,{whileHover:{x:4,color:"#818cf8"},onClick:()=>x("/app/links"),className:"text-sm font-semibold text-indigo-400 flex items-center gap-1 transition-colors",style:{background:"none",border:"none",cursor:"pointer"},children:[l("dashboard.recent.view_all")," ",e.jsx(D,{size:14})]})]}),e.jsxs("div",{className:"lp-recent-list",children:[f.map((s,a)=>e.jsxs(r.div,{className:"lp-recent-item",initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.7+a*.05},whileHover:{backgroundColor:"rgba(255,255,255,0.06)",scale:1.005},children:[e.jsx("div",{className:"lp-link-icon-circle",children:e.jsx(M,{size:16})}),e.jsxs("div",{className:"lp-link-info",children:[e.jsxs("span",{className:"lp-link-alias",children:["/",s.slug]}),e.jsx("span",{className:"lp-link-url",children:s.original_url})]}),e.jsxs("div",{className:"text-right min-w-[80px]",children:[e.jsxs("div",{className:"lp-link-money",children:["€",(s.earnings||0).toFixed(4)]}),e.jsxs("div",{className:"text-xs text-slate-500",children:[s.views||0," clicks"]})]})]},s.id)),f.length===0&&e.jsx("div",{className:"text-center py-8 text-slate-500 text-sm italic",children:l("dashboard.recent.empty_desc")||"No links yet."})]})]})]})})}export{J as DashboardPage};
