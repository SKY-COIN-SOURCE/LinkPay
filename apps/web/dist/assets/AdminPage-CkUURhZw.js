import{d as y,s as n,r as i,j as e,o as S,k as z,t as g,U as b}from"./index-D-S-xLlf.js";import{D as E}from"./dollar-sign-BdjNNnBM.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]],P=y("circle-x",D);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],N=y("refresh-ccw",R),p={getPendingWithdrawals:async()=>{const{data:a,error:s}=await n.from("withdrawals").select("*").eq("status","pending").order("created_at",{ascending:!0}).limit(50);return s?(console.error("Error fetching pending withdrawals:",s),[]):a},getStats:async()=>{const{count:a}=await n.from("withdrawals").select("*",{count:"exact",head:!0}).eq("status","pending"),{count:s}=await n.from("withdrawals").select("*",{count:"exact",head:!0}).eq("status","approved");return{pending:a||0,processed:s||0}},approveWithdrawal:async a=>{const{error:s}=await n.from("withdrawals").update({status:"approved",updated_at:new Date}).eq("id",a);if(s)throw s;return!0},rejectWithdrawal:async a=>{const{error:s}=await n.from("withdrawals").update({status:"rejected",updated_at:new Date}).eq("id",a);if(s)throw s;return!0}},w=({title:a,value:s,icon:d,colorClass:l})=>e.jsxs("div",{className:"bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg ${l} bg-opacity-10`,children:e.jsx(d,{size:24,className:l.replace("bg-","text-")})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-slate-400 uppercase tracking-wider",children:a}),e.jsx("p",{className:"text-2xl font-black text-slate-900",children:s})]})]});function _(){const[a,s]=i.useState("withdrawals"),[d,l]=i.useState([]),[o,h]=i.useState({pending:0,processed:0}),[v,f]=i.useState(!1),[m,c]=i.useState(null);i.useEffect(()=>{j()},[]);const j=async()=>{f(!0);try{const t=await p.getPendingWithdrawals(),x=await p.getStats();l(t),h(x)}catch(t){console.error("Error cargando dashboard:",t)}finally{f(!1)}},k=async(t,x)=>{if(window.confirm(`¿CONFIRMAR PAGO DE €${x.toFixed(2)}?
Esta acción notificará al usuario.`)){c(t);try{await p.approveWithdrawal(t),l(r=>r.filter(u=>u.id!==t)),h(r=>({...r,pending:r.pending-1,processed:r.processed+1}))}catch{alert("Error crítico al aprobar. Revisa la consola.")}finally{c(null)}}},C=async t=>{if(window.prompt("Motivo del rechazo (se enviará al usuario):","Datos bancarios incorrectos")){c(t);try{await p.rejectWithdrawal(t),l(r=>r.filter(u=>u.id!==t)),h(r=>({...r,pending:r.pending-1}))}catch{alert("Error al rechazar.")}finally{c(null)}}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 font-sans text-slate-900",children:[e.jsxs("nav",{className:"bg-slate-900 text-white px-8 py-4 flex justify-between items-center sticky top-0 z-50 shadow-md",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"bg-indigo-500 p-2 rounded-lg",children:e.jsx(S,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"font-bold text-lg tracking-tight",children:["LinkPay ",e.jsx("span",{className:"text-indigo-400",children:"Admin"})]}),e.jsx("p",{className:"text-[10px] text-slate-400 font-mono tracking-widest",children:"SECURE ENVIRONMENT"})]})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-slate-400 bg-slate-800 px-3 py-1 rounded-full flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"SYSTEM ONLINE"]}),e.jsx("button",{onClick:j,className:"p-2 hover:bg-slate-800 rounded-full transition-colors",title:"Refrescar Datos",children:e.jsx(N,{size:18,className:v?"animate-spin text-indigo-400":"text-slate-300"})})]})]}),e.jsxs("main",{className:"max-w-7xl mx-auto p-8",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx(w,{title:"Solicitudes Pendientes",value:o.pending,icon:z,colorClass:"bg-yellow-500"}),e.jsx(w,{title:"Pagos Procesados",value:o.processed,icon:g,colorClass:"bg-green-500"}),e.jsx(w,{title:"Usuarios Totales",value:"--",icon:b,colorClass:"bg-blue-500"})]}),e.jsxs("div",{className:"flex gap-6 border-b border-slate-200 mb-8",children:[e.jsxs("button",{onClick:()=>s("withdrawals"),className:`pb-4 px-2 text-sm font-bold flex items-center gap-2 transition-colors ${a==="withdrawals"?"border-b-2 border-indigo-600 text-indigo-600":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(E,{size:16})," Cola de Pagos",o.pending>0&&e.jsx("span",{className:"bg-red-500 text-white text-[10px] px-2 py-0.5 rounded-full",children:o.pending})]}),e.jsxs("button",{onClick:()=>s("users"),className:`pb-4 px-2 text-sm font-bold flex items-center gap-2 transition-colors ${a==="users"?"border-b-2 border-indigo-600 text-indigo-600":"text-slate-500 hover:text-slate-700"}`,children:[e.jsx(b,{size:16})," Gestión de Usuarios"]})]}),a==="withdrawals"&&e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden",children:d.length===0?e.jsxs("div",{className:"py-20 flex flex-col items-center justify-center text-slate-400",children:[e.jsx(g,{size:64,className:"mb-4 text-slate-200"}),e.jsx("p",{className:"font-medium text-lg",children:"Todo limpio por aquí"}),e.jsx("p",{className:"text-sm",children:"No hay pagos pendientes de revisión."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-left",children:[e.jsx("thead",{className:"bg-slate-50 border-b border-slate-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Fecha / ID"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Método"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider",children:"Detalles de Cuenta"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-right",children:"Importe"}),e.jsx("th",{className:"px-6 py-4 text-xs font-bold text-slate-500 uppercase tracking-wider text-center",children:"Acciones"})]})}),e.jsx("tbody",{className:"divide-y divide-slate-100",children:d.map(t=>e.jsxs("tr",{className:"hover:bg-indigo-50/30 transition-colors group",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"font-bold text-slate-700 text-sm",children:new Date(t.created_at).toLocaleDateString()}),e.jsxs("div",{className:"text-[10px] font-mono text-slate-400 group-hover:text-indigo-400",children:[t.id.slice(0,8),"..."]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${t.method==="PayPal"?"bg-blue-100 text-blue-800":t.method==="Crypto"?"bg-orange-100 text-orange-800":"bg-slate-100 text-slate-800"}`,children:t.method})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex items-center gap-2 font-mono text-sm text-slate-600 bg-slate-50 px-3 py-1 rounded border border-slate-200 w-fit",children:t.account_details})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("span",{className:"text-lg font-black text-slate-900 tracking-tight",children:["€",t.amount.toFixed(2)]})}),e.jsxs("td",{className:"px-6 py-4 flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>k(t.id,t.amount),disabled:m===t.id,className:"p-2 bg-green-50 text-green-600 rounded-lg border border-green-200 hover:bg-green-600 hover:text-white transition-all shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Aprobar Pago",children:m===t.id?e.jsx(N,{className:"animate-spin",size:18}):e.jsx(g,{size:18})}),e.jsx("button",{onClick:()=>C(t.id),disabled:m===t.id,className:"p-2 bg-white text-slate-400 rounded-lg border border-slate-200 hover:bg-red-50 hover:text-red-600 hover:border-red-200 transition-all shadow-sm disabled:opacity-50",title:"Rechazar y devolver saldo",children:e.jsx(P,{size:18})})]})]},t.id))})]})})}),a==="users"&&e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center",children:[e.jsx("div",{className:"inline-block p-4 bg-slate-50 rounded-full mb-4",children:e.jsx(b,{size:32,className:"text-slate-400"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-900",children:"Gestión de Usuarios"}),e.jsx("p",{className:"text-slate-500 max-w-md mx-auto mt-2",children:"Pronto podrás ver, editar y banear usuarios desde aquí. Esta función está en desarrollo en el siguiente sprint."})]})]})]})}export{_ as AdminPage};
